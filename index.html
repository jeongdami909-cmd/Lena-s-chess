<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>나만의 체스 앱 - v1</title>
    <link rel="stylesheet" href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css">
    <style>
        body { 
            font-family: sans-serif; 
            text-align: center; 
            background-color: #fcf9f2; 
            color: #333; 
            padding: 20px;
        }
        #myBoard { 
            width: 100%; 
            max-width: 400px; 
            margin: 20px auto; 
        }
        /* 따뜻한 갈색 톤 테마 적용 */
        .white-1e1d7 { background-color: #f0d9b5; }
        .black-3c85d { background-color: #b58863; }
        .info { 
            margin-top: 20px; 
            font-size: 1.2em; 
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h2>나만의 체스 앱 (1차 버전)</h2>
    <div id="myBoard"></div>
    <div class="info">상태: <span id="status">백의 차례</span></div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.2/chess.js"></script>
    
    <script>
        var board = null;
        var game = new Chess();
        var $status = $('#status');

        // 기물을 집어들 때 (자신의 턴이 아니면 못 움직임)
        function onDragStart (source, piece, position, orientation) {
            if (game.game_over()) return false;
            if ((game.turn() === 'w' && piece.search(/^b/) !== -1) ||
                (game.turn() === 'b' && piece.search(/^w/) !== -1)) {
                return false;
            }
        }

        // 기물을 내려놓을 때 (규칙에 어긋나면 원위치)
        function onDrop (source, target) {
            var move = game.move({
                from: source,
                to: target,
                promotion: 'q' // 무조건 퀸으로 승급하도록 임시 설정
            });
            if (move === null) return 'snapback';
            updateStatus();
        }

        // 이동이 끝난 후 보드 상태 업데이트
        function onSnapEnd () {
            board.position(game.fen());
        }

        // 게임 상태(체크, 체크메이트, 턴) 텍스트 업데이트
        function updateStatus () {
            var statusHTML = '';
            var moveColor = '백';
            if (game.turn() === 'b') { moveColor = '흑'; }

            if (game.in_checkmate()) { 
                statusHTML = '게임 종료, ' + moveColor + '이(가) 체크메이트 당했습니다.'; 
            } else if (game.in_draw()) { 
                statusHTML = '게임 종료, 무승부입니다.'; 
            } else {
                statusHTML = moveColor + '의 차례';
                if (game.in_check()) { 
                    statusHTML += ', ' + moveColor + '이(가) 체크 상태입니다!'; 
                }
            }
            $status.html(statusHTML);
        }

        // 체스판 설정
        var config = {
            draggable: true,
            position: 'start',
            onDragStart: onDragStart,
            onDrop: onDrop,
            onSnapEnd: onSnapEnd
        };
        board = Chessboard('myBoard', config);
        updateStatus();
    </script>
</body>
</html>
